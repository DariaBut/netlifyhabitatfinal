{"version":3,"file":"resolveJSSData.js","sourceRoot":"","sources":["../../../src/renderingHost/resolveJSSData.ts"],"names":[],"mappings":";;;AAAA,2DAAyD;AASzD,SAAgB,gCAAgC,CAAC,GAAsB;IACnE,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE;QACX,MAAM,IAAI,KAAK,CAAC,8DAA8D,CAAC,CAAC;KACnF;IACD,kGAAkG;IAClG,IAAM,cAAc,GAAG,GAAG,CAAC,IAAI,CAAC;IAEhC,wFAAwF;IACxF,IAAI;IACJ,wBAAwB;IACxB,wFAAwF;IACxF,gCAAgC;IAChC,gCAAgC;IAChC,IAAI;IAEJ,IAAM,MAAM,GAAG;QACX,KAAK,EAAE,IAAI;QACX,OAAO,EAAE,IAAI;QACb,UAAU,EAAE,EAAE;KACjB,CAAC;IAEF,IAAI,CAAC,cAAc,IAAI,CAAC,cAAc,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;QAChF,OAAO,MAAM,CAAC;KACjB;IAED,MAAM,CAAC,UAAU,GAAG,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAE3C,IAAI,cAAc,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;QAC1D,MAAM,CAAC,KAAK,GAAG,4BAAY,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;KACvD;IAED,IAAI,cAAc,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;QAC1D,MAAM,CAAC,OAAO,GAAG,4BAAY,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;KACzD;IAED,OAAO,MAAM,CAAC;AAClB,CAAC;AApCD,4EAoCC","sourcesContent":["import { tryParseJson } from '@uniformdev/common-server';\r\nimport { SitecoreWebhookRequestData } from '@uniformdev/next-jss';\r\n\r\nexport interface CompatibleRequest {\r\n    body?: {\r\n        args?: string[];\r\n    };\r\n}\r\n\r\nexport function resolveJssDataFromWebhookRequest(req: CompatibleRequest): SitecoreWebhookRequestData {\r\n    if (!req.body) {\r\n        throw new Error('Rendering host request does not contain any data in the body');\r\n    }\r\n    // We assume req.body has already been parsed as JSON via something like `body-parser` middleware.\r\n    const invocationInfo = req.body;\r\n\r\n    // By default, the JSS server invokes this route with the following body data structure:\r\n    // {\r\n    //   id: 'JSS app name',\r\n    //   args: ['route path', 'serialized layout data object', 'serialized viewbag object'],\r\n    //   functionName: 'renderView',\r\n    //   moduleName: 'server.bundle'\r\n    // }\r\n\r\n    const result = {\r\n        route: null,\r\n        viewBag: null,\r\n        renderPath: '',\r\n    };\r\n\r\n    if (!invocationInfo || !invocationInfo.args || !Array.isArray(invocationInfo.args)) {\r\n        return result;\r\n    }\r\n\r\n    result.renderPath = invocationInfo.args[0];\r\n\r\n    if (invocationInfo.args.length > 0 && invocationInfo.args[1]) {\r\n        result.route = tryParseJson(invocationInfo.args[1]);\r\n    }\r\n\r\n    if (invocationInfo.args.length > 1 && invocationInfo.args[2]) {\r\n        result.viewBag = tryParseJson(invocationInfo.args[2]);\r\n    }\r\n\r\n    return result;\r\n}\r\n"]}